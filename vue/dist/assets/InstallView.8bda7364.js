import{a as I,p as re,m as ue,o as de,b as ce,g as me,u as ve,c as pe,d as fe,e as $,f as _e,h as be,V as ee,i as te,j as c,k as G,l as k,n as d,q as w,r as y,t as E,s as l,_ as B,F as P,v as K,w as C,x as M,y as D,z as b,A as V,B as ge,C as N,D as ye,E as ae,G as we,H as se,I as he,J as Ve,K as ne,L as Ce,M as xe,N as le,O as oe,P as J,Q as Ie,R as ke,S as Be,T as Se,U as Ee,W as $e}from"./index.484b954d.js";const{Axios:bt,AxiosError:Ue,CanceledError:gt,isCancel:yt,CancelToken:wt,VERSION:ht,all:Vt,Cancel:Ct,isAxiosError:xt,spread:It,toFormData:kt,AxiosHeaders:Bt,HttpStatusCode:St,formToJSON:Et,getAdapter:$t,mergeConfig:Ut}=I;const Le=re({...ue(),...de(ce(),["inline"])},"VCheckbox"),Fe=me()({name:"VCheckbox",inheritAttrs:!1,props:Le(),emits:{"update:modelValue":g=>!0,"update:focused":g=>!0},setup(g,n){let{attrs:e,slots:s}=n;const i=ve(g,"modelValue"),{isFocused:t,focus:a,blur:r}=pe(g),o=fe(),u=$(()=>g.id||`checkbox-${o}`);return _e(()=>{const[v,p]=be(e),f=ee.filterProps(g),x=te.filterProps(g);return c(ee,G({class:["v-checkbox",g.class]},v,f,{modelValue:i.value,"onUpdate:modelValue":L=>i.value=L,id:u.value,focused:t.value,style:g.style}),{...s,default:L=>{let{id:q,messagesId:z,isDisabled:O,isReadonly:j,isValid:R}=L;return c(te,G(x,{id:q.value,"aria-describedby":z.value,disabled:O.value,readonly:j.value},p,{error:R.value===!1,modelValue:i.value,"onUpdate:modelValue":H=>i.value=H,onFocus:a,onBlur:r}),s)}})}),{}}}),Ae={class:"install-view-license"},De={class:"install-view-license-content"},Ne=k({__name:"InstallViewLicense",setup(g,{expose:n}){const e=U();return n({nextBtn:{label:"Accept"}}),(s,i)=>(d(),w("div",Ae,[y("div",De,E(l(e).license),1)]))}});const Pe=B(Ne,[["__scopeId","data-v-4019f6dd"]]),Me={class:"install-view-environment"},Te={style:{display:"flex",gap:"8px","flex-wrap":"wrap"}},qe={class:"install-view-environment-item-title"},ze={key:0,class:"install-view-environment-item-message"},Oe=k({__name:"InstallViewEnvironment",setup(g,{expose:n}){const e=U(),s=$(()=>e.environment&&Object.values(e.environment).every(t=>t.status===1)),i=$(()=>s.value?"Next":"Recheck");return n({nextBtn:{label:i,action:()=>{s.value?e.nextStep():e.recheckEnvironment()}}}),(t,a)=>(d(),w("div",Me,[(d(!0),w(P,null,K(l(e).environment,(r,o)=>(d(),w("div",{key:o,class:"install-view-environment-item"},[r.status===1?(d(),C(M,{key:0,icon:"mdi-check-circle",color:"#097c31",size:"20"})):(d(),C(M,{key:1,icon:"mdi-close-circle",color:"#ac0221",size:"20"})),y("div",Te,[y("span",qe,E(r.label),1),r.message?(d(),w("span",ze,E(r.message),1)):D("",!0)])]))),128))]))}});const je=B(Oe,[["__scopeId","data-v-ec046cca"]]),Re={class:"install-view-database-config"},He=k({__name:"InstallViewDatabaseConfig",setup(g,{expose:n}){const e=U(),s=b({dbname:"",host:"",port:"",username:""});return n({nextBtn:{action:async()=>{await e.validateDb()&&e.nextStep()}},validate:()=>{var t,a,r;s.value={dbname:"",host:"",port:"",username:""};let i=!0;return(t=e.databaseConfig.dbname)!=null&&t.trim()||(s.value.dbname="Field is required",i=!1),(a=e.databaseConfig.host)!=null&&a.trim()||(s.value.host="Field is required",i=!1),e.databaseConfig.port||(s.value.port="Field is required",i=!1),(r=e.databaseConfig.username)!=null&&r.trim()||(s.value.username="Field is required",i=!1),i}}),(i,t)=>(d(),w("div",Re,[c(V,{modelValue:l(e).databaseConfig.dbname,"onUpdate:modelValue":t[0]||(t[0]=a=>l(e).databaseConfig.dbname=a),label:"Database name",variant:"outlined",density:"comfortable","error-messages":s.value.dbname,"hide-details":"auto"},null,8,["modelValue","error-messages"]),c(V,{modelValue:l(e).databaseConfig.host,"onUpdate:modelValue":t[1]||(t[1]=a=>l(e).databaseConfig.host=a),label:"Database host",variant:"outlined",density:"comfortable","error-messages":s.value.host,"hide-details":"auto"},null,8,["modelValue","error-messages"]),c(V,{modelValue:l(e).databaseConfig.port,"onUpdate:modelValue":t[2]||(t[2]=a=>l(e).databaseConfig.port=a),label:"Database port",variant:"outlined",density:"comfortable","error-messages":s.value.port,"hide-details":"auto"},null,8,["modelValue","error-messages"]),c(V,{modelValue:l(e).databaseConfig.username,"onUpdate:modelValue":t[3]||(t[3]=a=>l(e).databaseConfig.username=a),label:"Username",variant:"outlined",density:"comfortable","error-messages":s.value.username,"hide-details":"auto"},null,8,["modelValue","error-messages"]),c(V,{modelValue:l(e).databaseConfig.password,"onUpdate:modelValue":t[4]||(t[4]=a=>l(e).databaseConfig.password=a),type:"password",label:"Password (optional)",variant:"outlined",density:"comfortable",autocomplete:"one-time-code","hide-details":"auto"},null,8,["modelValue"]),c(ge,{modelValue:l(e).databaseConfig.collation,"onUpdate:modelValue":t[5]||(t[5]=a=>l(e).databaseConfig.collation=a),items:l(T).db_collations,label:"Database collation",variant:"outlined",density:"comfortable","hide-details":"auto"},null,8,["modelValue","items"])]))}});const Ge=B(He,[["__scopeId","data-v-38e4ac00"]]),Je={class:"install-view-elastic-config"},Ke=k({__name:"InstallViewElasticConfig",setup(g,{expose:n}){const e=U(),s=b({host:"",port:""});return n({nextBtn:{action:async()=>{await e.validateElastic()&&e.nextStep()}},validate:()=>{var t;s.value={host:"",port:""};let i=!0;return(t=e.elasticConfig.host)!=null&&t.trim()||(s.value.host="Field is required",i=!1),e.elasticConfig.port||(s.value.port="Field is required",i=!1),i}}),(i,t)=>(d(),w("div",Je,[c(V,{modelValue:l(e).elasticConfig.host,"onUpdate:modelValue":t[0]||(t[0]=a=>l(e).elasticConfig.host=a),label:"Elastic host",variant:"outlined",density:"comfortable","error-messages":s.value.host,"hide-details":"auto"},null,8,["modelValue","error-messages"]),c(V,{modelValue:l(e).elasticConfig.port,"onUpdate:modelValue":t[1]||(t[1]=a=>l(e).elasticConfig.port=a),label:"Elastic port",variant:"outlined",density:"comfortable","error-messages":s.value.port,"hide-details":"auto"},null,8,["modelValue","error-messages"]),c(V,{modelValue:l(e).elasticConfig.username,"onUpdate:modelValue":t[2]||(t[2]=a=>l(e).elasticConfig.username=a),label:"Username (optional)",variant:"outlined",density:"comfortable","hide-details":""},null,8,["modelValue"]),c(V,{modelValue:l(e).elasticConfig.password,"onUpdate:modelValue":t[3]||(t[3]=a=>l(e).elasticConfig.password=a),type:"password",label:"Password (optional)",variant:"outlined",density:"comfortable",autocomplete:"one-time-code","hide-details":""},null,8,["modelValue"])]))}});const We=B(Ke,[["__scopeId","data-v-166cc1bb"]]),Qe={class:"install-view-site-config"},Xe={class:"install-view-dummy-data"},Ye={class:"install-view-dummy-data-help"},Ze=k({__name:"InstallViewSiteConfig",setup(g,{expose:n}){const e=U(),s=b(!1),i=b({url:"",username:"",password:""});return n({validate:()=>{var a,r,o;i.value={url:"",username:"",password:""};let t=!0;return(a=e.siteConfig.url)!=null&&a.trim()||(i.value.url="Field is required",t=!1),(r=e.siteConfig.username)!=null&&r.trim()||(i.value.username="Field is required",t=!1),(o=e.siteConfig.password)!=null&&o.trim()||(i.value.password="Field is required",t=!1),t}}),(t,a)=>(d(),w("div",Qe,[c(V,{modelValue:l(e).siteConfig.url,"onUpdate:modelValue":a[0]||(a[0]=r=>l(e).siteConfig.url=r),label:"Site URL",variant:"outlined",density:"comfortable","error-messages":i.value.url,"hide-details":"auto"},null,8,["modelValue","error-messages"]),c(V,{modelValue:l(e).siteConfig.username,"onUpdate:modelValue":a[1]||(a[1]=r=>l(e).siteConfig.username=r),label:"Admin username",variant:"outlined",density:"comfortable","error-messages":i.value.username,"hide-details":"auto"},null,8,["modelValue","error-messages"]),c(V,{modelValue:l(e).siteConfig.password,"onUpdate:modelValue":a[2]||(a[2]=r=>l(e).siteConfig.password=r),type:s.value?"text":"password",label:"Admin password",variant:"outlined",density:"comfortable",autocomplete:"one-time-code","append-inner-icon":s.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":a[3]||(a[3]=r=>s.value=!s.value),"error-messages":i.value.password,"hide-details":"auto"},null,8,["modelValue","type","append-inner-icon","error-messages"]),y("div",Xe,[c(Fe,{modelValue:l(e).siteConfig.demodata,"onUpdate:modelValue":a[4]||(a[4]=r=>l(e).siteConfig.demodata=r),color:"secondary",label:"Import dummy data","hide-details":""},null,8,["modelValue"]),c(ye,{location:"top start",text:"A set of dummy records will be installed on your system for demonstration purposes."},{activator:N(({props:r})=>[y("div",Ye,[c(M,G(r,{icon:"mdi-help",size:"14",color:"white"}),null,16)])]),_:1})])]))}});const et=B(Ze,[["__scopeId","data-v-e0e38c7c"]]),tt={class:"install-view-installation"},at={class:"installation-step-label"},st=k({__name:"InstallViewInstallation",setup(g,{expose:n}){const e=U(),s=b({}),i=b(null),t=b(null);n({prevBtn:!1,nextBtn:!1}),ae(async()=>{e.install(),await a(),t.value=setInterval(async()=>{await a()},1e3)}),we(()=>{t.value&&clearInterval(t.value)});async function a(){var o;try{const u=await I.get("api/install/status");Object.keys(u.data||{}).length!==Object.keys(s.value).length&&(s.value=u.data||{})}catch(u){u instanceof Ue&&((o=u.response)==null?void 0:o.status)===404&&(e.isInstallationCompleted=!0)}}const r=$(()=>{var o;return Object.keys((o=s.value)!=null?o:{}).length?Object.keys(s.value).map(u=>parseInt(u)).sort((u,v)=>u<v?1:u>v?-1:0)[0]:0});return se(()=>s.value,async()=>{var o;await Ve(),(o=i.value)==null||o.scrollTo({behavior:"smooth",left:0,top:i.value.scrollHeight})}),(o,u)=>(d(),w("div",tt,[c(he,{color:"primary",stream:"","rounded-bar":"",rounded:"",height:"6",style:{"min-height":"6px"},"model-value":r.value,max:21},null,8,["model-value"]),y("div",{class:"install-view-installation-steps",ref_key:"stepsContainer",ref:i},[(d(!0),w(P,null,K(s.value,(v,p)=>(d(),w("div",{key:p,class:"install-view-installation-step"},[parseInt(p)===r.value?(d(),C(ne,{key:0,indeterminate:"",color:"primary",size:"20",width:"2",style:{overflow:"hidden"}})):(d(),C(M,{key:1,icon:"mdi-check-circle",color:"#097c31",size:"20"})),y("span",at,E(v.replaceAll("_"," ")),1)]))),128))],512)]))}});const nt=B(st,[["__scopeId","data-v-b87e48e3"]]),T={steps:[{title:"License",component:Pe},{title:"System Environment Check",component:je},{title:"Database configuration",component:Ge},{title:"ElasticSearch configuration",component:We},{title:"Site configuration",component:et},{title:"Installation",component:nt}],db_collations:["utf8mb4_general_ci","utf8mb4_bin","utf8mb4_unicode_ci","utf8mb4_icelandic_ci","utf8mb4_latvian_ci","utf8mb4_romanian_ci","utf8mb4_slovenian_ci","utf8mb4_polish_ci","utf8mb4_estonian_ci","utf8mb4_spanish_ci","utf8mb4_swedish_ci","utf8mb4_turkish_ci","utf8mb4_czech_ci","utf8mb4_danish_ci","utf8mb4_lithuanian_ci","utf8mb4_slovak_ci","utf8mb4_spanish2_ci","utf8mb4_roman_ci","utf8mb4_persian_ci","utf8mb4_esperanto_ci","utf8mb4_hungarian_ci","utf8mb4_sinhala_ci","utf8mb4_german2_ci","utf8mb4_croatian_ci","utf8mb4_unicode_520_ci","utf8mb4_vietnamese_ci"]},U=Ce("install-view",()=>{const g=xe(),n=b(!1),e=b(!1),s=b(!1),i=b(""),t=b(null),a=b(null),r=b(!1),o=b({dbname:"minthcm",host:"localhost",port:3306,username:"root",password:"",collation:"utf8mb4_general_ci"}),u=b({host:"localhost",port:9200,username:"",password:""}),v=b({url:window.location.href.split("#")[0],username:"admin",password:"",demodata:!1}),p=b(""),f=b(0),x=$(()=>T.steps[f.value]);async function L(){var _,h,m,F,A,W,Q,X,Y,Z;e.value=!0;try{const S=await I.get("api/install/init");i.value=(h=(_=S.data)==null?void 0:_.version)!=null?h:"",t.value=(F=(m=S.data)==null?void 0:m.license)!=null?F:"",a.value=(W=(A=S.data)==null?void 0:A.environment)!=null?W:"",r.value=(X=(Q=S.data)==null?void 0:Q.isInstalling)!=null?X:!1,e.value=!1,(Y=S.data)!=null&&Y.isInstalling&&(f.value=T.steps.length-1)}catch(S){((Z=S.response)==null?void 0:Z.status)===404&&g.push({name:"dashboard"})}}async function q(){var h,m;const _=await I.get("api/install/license");t.value=(m=(h=_.data)==null?void 0:h.license)!=null?m:""}async function z(){n.value=!0;const _=await I.get("api/install/init");_.data.environment&&(a.value=_.data.environment),n.value=!1}async function O(){var _,h;n.value=!0;try{const m=await I.post("api/install/validate_db",o.value);return n.value=!1,((_=m.data)==null?void 0:_.status)===0?(p.value=m.data.message,console.error((h=m.data.error)!=null?h:m.data.message),!1):!0}catch(m){return console.error(m),p.value="Server error",n.value=!1,!1}}async function j(){var _,h;n.value=!0;try{const m=await I.post("api/install/validate_elastic",u.value);return n.value=!1,((_=m.data)==null?void 0:_.status)===0?(p.value=m.data.message,console.error((h=m.data.error)!=null?h:m.data.message),!1):!0}catch(m){return console.error(m),p.value="Server error",n.value=!1,!1}}async function R(){var h,m,F;if(r.value==!0)return!0;r.value=!0;const _=await I.post("api/install/submit",{db:o.value,elastic:u.value,site:v.value});if(typeof _.data=="string"||typeof _.data=="object"&&((h=_.data)==null?void 0:h.status)===0){const A=(F=(m=_.data.error)!=null?m:_.data.message)!=null?F:_.data;return p.value=A,console.error(A),!1}return s.value=!0,!0}function H(){f.value--}function ie(){f.value++}return se(()=>f.value,()=>p.value=""),{currentStepNumber:f,currentStep:x,isInitialLoading:e,isLoading:n,isInstallationCompleted:s,version:i,license:t,environment:a,databaseConfig:o,elasticConfig:u,siteConfig:v,errorMsg:p,prevStep:H,nextStep:ie,fetchLicense:q,recheckEnvironment:z,fetchInitialData:L,validateDb:O,validateElastic:j,install:R,isInstalling:r}}),lt={class:"install-view-completed"},ot=k({__name:"InstallViewCompleted",setup(g){function n(){location.reload()}return(e,s)=>(d(),w("div",lt,[s[1]||(s[1]=y("h1",null,"Finished",-1)),c(oe,{type:"success"},{default:N(()=>s[0]||(s[0]=[le(" Your MintHCM installation is ready. Go ahead and log-in as an administrator. ")])),_:1}),c(J,{variant:"primary",text:"Go to login",style:{width:"100%"},onClick:n})]))}});const it=B(ot,[["__scopeId","data-v-a7508c66"]]),rt={key:1,class:"install-view"},ut={class:"install-view-title"},dt={class:"install-view-container"},ct={key:0,class:"install-view-loader"},mt={class:"install-view-container-title"},vt={class:"install-view-buttons"},pt={class:"install-view-footer"},ft=k({__name:"InstallView",setup(g){const n=U(),e=b(null),s=$(()=>{var o,u,v,p,f,x;return typeof((u=(o=e.value)==null?void 0:o.prevBtn)==null?void 0:u.label)=="string"?e.value.prevBtn.label:((p=(v=e.value)==null?void 0:v.prevBtn)==null?void 0:p.label)&&typeof((x=(f=e.value)==null?void 0:f.prevBtn)==null?void 0:x.label)=="object"?e.value.prevBtn.label.value:"Back"}),i=$(()=>{var o,u,v,p,f,x;return typeof((u=(o=e.value)==null?void 0:o.nextBtn)==null?void 0:u.label)=="string"?e.value.nextBtn.label:((p=(v=e.value)==null?void 0:v.nextBtn)==null?void 0:p.label)&&typeof((x=(f=e.value)==null?void 0:f.nextBtn)==null?void 0:x.label)=="object"?e.value.nextBtn.label.value:"Next"});ae(()=>{n.fetchInitialData(),window.addEventListener("keydown",t)}),Ie(()=>{window.removeEventListener("keydown",t)});function t(o){if(!(n.isInstalling||document.querySelectorAll(".v-menu .v-list").length>0)){if(o.key==="Enter"){if(n.isInstallationCompleted){location.reload();return}r()}(o.key==="Escape"||o.key==="Esc")&&n.currentStepNumber!==0&&!n.isInstallationCompleted&&a()}}function a(){var o,u;((o=e.value)==null?void 0:o.prevBtn)&&typeof e.value.prevBtn.action=="function"?(u=e.value)==null||u.prevBtn.action():n.prevStep()}function r(){var o,u,v;typeof((o=e.value)==null?void 0:o.validate)=="function"&&!e.value.validate()||(((u=e.value)==null?void 0:u.nextBtn)&&typeof e.value.nextBtn.action=="function"?(v=e.value)==null||v.nextBtn.action():n.nextStep())}return(o,u)=>{var v,p;return l(n).isInitialLoading?(d(),C(Se,{key:0})):(d(),w("div",rt,[y("div",ut,[u[0]||(u[0]=y("h1",null,"MintHCM Setup Wizard",-1)),y("span",null,"Version "+E(l(n).version),1)]),y("div",dt,[l(n).isInstallationCompleted?(d(),C(it,{key:0})):(d(),w(P,{key:1},[c(ke,null,{default:N(()=>[l(n).isLoading?(d(),w("div",ct,[c(ne,{indeterminate:"",color:"primary",size:"64"})])):D("",!0)]),_:1}),y("div",mt,E(l(n).currentStep.title),1),l(n).errorMsg?(d(),C(oe,{key:0,type:"error"},{default:N(()=>[le(E(l(n).errorMsg),1)]),_:1})):D("",!0),c(Be,{"hide-on-leave":""},{default:N(()=>{var f;return[(d(),C(Ee((f=l(n).currentStep)==null?void 0:f.component),{ref_key:"stepComponent",ref:e},null,512))]}),_:1}),y("div",vt,[((v=e.value)==null?void 0:v.prevBtn)!==!1&&l(n).currentStepNumber!==0?(d(),C(J,{key:0,variant:"text",text:s.value,onClick:a},null,8,["text"])):D("",!0),((p=e.value)==null?void 0:p.nextBtn)!==!1?(d(),C(J,{key:1,variant:"primary",text:i.value,onClick:r},null,8,["text"])):D("",!0)]),y("div",pt,[(d(!0),w(P,null,K(l(T).steps.length,f=>(d(),w("div",{key:f,class:$e({"install-view-footer-dot":!0,"install-view-footer-dot-active":l(n).currentStepNumber===f-1})},null,2))),128))])],64))]),u[1]||(u[1]=y("div",{class:"install-view-footer"},[y("a",{href:"https://minthcm.org",target:"_blank"}," www.minthcm.org ")],-1))]))}}});const Lt=B(ft,[["__scopeId","data-v-6f321b40"]]);export{Lt as default};
